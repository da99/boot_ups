# -*- bash -*-
#
boot="$BOOT_STRAP_PATH"
if [[ -z "$boot" ]]
then
  echo "BOOT_STRAP_PATH not set. exiting..."
  exit 1
fi

lsrc=luajit-2.0_src
lua_path="$boot/luajit"
set -u -e -o pipefail


sudo apt-get install libc6-dev

cd $boot
if [[ -d $lsrc  ]]
then
  cd $lsrc
  git pull
else
  git clone http://luajit.org/git/luajit-2.0.git $lsrc
  cd $lsrc
fi

old="export PREFIX= /usr/local"
new="export PREFIX= $lua_path"
sed -i  "s|$old|$new|" Makefile
make PREFIX="$lua_path"
make install PREFIX="$lua_path"
git checkout Makefile

if [[ "$(command -v luajit)" != "$lua_path/bin/luajit" ]]
then
  echo "Put this in your path: $lua_path/bin"
fi
