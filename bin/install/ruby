#!/usr/bin/env bash
# -*- bash -*-
#
#!/usr/bin/env node
# -*- js   -*-
#
#!/usr/bin/env lua
#
#
set -u -e -o pipefail

apps=$(pwd)
up=$apps/boot_ups/bin

mkdir -p ruby
cd ruby
base=ruby-2.0.0-p247
rm -f $base.tar.gz

if [[ ! -d $base ]]
then
  curl -O ftp://ftp.ruby-lang.org/pub/ruby/2.0/$base.tar.gz
  $up/util/untar $base.tar.gz
fi

cd $base

# === https://github.com/wayneeseguin/rvm/blob/master/scripts/functions/requirements/ubuntu 
# sudo apt-get update
sudo apt-get install git-core \
  curl gawk zlib1g-dev        \
  build-essential libssl-dev  \
  libreadline-dev libyaml-dev \
  libsqlite3-dev sqlite3      \
  libxml2-dev libxslt-dev     \
bash curl patch bzip2 ca-certificates gawk \
g++ gcc make libc6-dev patch openssl ca-certificates libreadline6 \
libreadline6-dev curl zlib1g zlib1g-dev libssl-dev libyaml-dev \
libsqlite3-dev sqlite3 autoconf \
libgdbm-dev libncurses5-dev automake libtool bison pkg-config libffi-dev

./configure --prefix=$apps/ruby --enable-shared --disable-install-doc
make
make check || true
make install
$apps/ruby/bin/gem update
$apps/ruby/bin/gem update --system
$apps/ruby/bin/gem install bundler

echo -e "\n==== Done."
$apps/ruby/bin/ruby -v


