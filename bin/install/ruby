#!/usr/bin/env bash
# -*- bash -*-
#
#!/usr/bin/env node
# -*- js   -*-
#
#!/usr/bin/env lua
#
#
set -u -e -o pipefail

up="$UP"
base=ruby-2.0.0-p247
target=$(pwd)/$base

if [[ ! -d "${base}-src" ]]
then
  rm -f $base.tar.gz
  curl -O ftp://ftp.ruby-lang.org/pub/ruby/2.0/$base.tar.gz
  $up/util/untar $base.tar.gz
  mv $base ${base}-src
fi

cd ${base}-src

# === https://github.com/wayneeseguin/rvm/blob/master/scripts/functions/requirements/ubuntu 
# sudo apt-get update
sudo apt-get install git-core \
  curl gawk zlib1g-dev        \
  build-essential libssl-dev  \
  libreadline-dev libyaml-dev \
  libsqlite3-dev sqlite3      \
  libxml2-dev libxslt-dev     \
bash curl patch bzip2 ca-certificates gawk \
g++ gcc make libc6-dev patch openssl ca-certificates libreadline6 \
libreadline6-dev curl zlib1g zlib1g-dev libssl-dev libyaml-dev \
libsqlite3-dev sqlite3 autoconf \
libgdbm-dev libncurses5-dev automake libtool bison pkg-config libffi-dev

./configure --prefix=$target --enable-shared --disable-install-doc
make
# make check || true

$UP/install/gemrc_config

make install
$target/bin/gem update --no-document
$target/bin/gem update --system
$target/bin/gem install bundler --no-document

echo -e "\n==== Done."
$target/bin/ruby -v


